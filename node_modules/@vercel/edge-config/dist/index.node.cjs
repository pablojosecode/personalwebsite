"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var _chunkSKL7TQPTcjs = require('./chunk-SKL7TQPT.cjs');var _promises = require('fs/promises'); var _promises2 = _interopRequireDefault(_promises);async function u(o){if(!process.env.AWS_LAMBDA_FUNCTION_NAME)return null;try{let i=await _promises2.default.readFile(`/opt/edge-config/${o.id}.json`,"utf-8");return JSON.parse(i)}catch (e2){return null}}function N(o){if(!o)throw new Error("@vercel/edge-config: No connection string provided");let i=_chunkSKL7TQPTcjs.g.call(void 0, o);if(!i)throw new Error("@vercel/edge-config: Invalid connection string provided");let f=`https://edge-config.vercel.com/${i.id}`,h="1",c={Authorization:`Bearer ${i.token}`};return{async get(e){let n=await u(i);return n?(_chunkSKL7TQPTcjs.d.call(void 0, e),Promise.resolve(_chunkSKL7TQPTcjs.f.call(void 0, n.items[e]))):(_chunkSKL7TQPTcjs.d.call(void 0, e),_chunkSKL7TQPTcjs.h.call(void 0, `${f}/item/${e}?version=${h}`,{headers:new Headers(c),cache:"no-store"}).then(async r=>{if(r.ok)return r.json();if(await r.arrayBuffer(),r.status===401)throw new Error(_chunkSKL7TQPTcjs.a.UNAUTHORIZED);if(r.status===404){if(r.headers.has("x-edge-config-digest"))return;throw new Error(_chunkSKL7TQPTcjs.a.EDGE_CONFIG_NOT_FOUND)}if(r.cachedResponseBody!==void 0)return r.cachedResponseBody;throw new Error(_chunkSKL7TQPTcjs.a.UNEXPECTED)},()=>{throw new Error(_chunkSKL7TQPTcjs.a.NETWORK)}))},async has(e){let n=await u(i);return n?(_chunkSKL7TQPTcjs.d.call(void 0, e),Promise.resolve(_chunkSKL7TQPTcjs.b.call(void 0, n.items,e))):(_chunkSKL7TQPTcjs.d.call(void 0, e),_chunkSKL7TQPTcjs.h.call(void 0, `${f}/item/${e}?version=${h}`,{method:"HEAD",headers:new Headers(c),cache:"no-store"}).then(r=>{if(r.status===401)throw new Error(_chunkSKL7TQPTcjs.a.UNAUTHORIZED);if(r.status===404){if(r.headers.has("x-edge-config-digest"))return!1;throw new Error(_chunkSKL7TQPTcjs.a.EDGE_CONFIG_NOT_FOUND)}if(r.ok)return!0;throw new Error(_chunkSKL7TQPTcjs.a.UNEXPECTED)},()=>{throw new Error(_chunkSKL7TQPTcjs.a.NETWORK)}))},async getAll(e){let n=await u(i);if(n)return e===void 0?Promise.resolve(_chunkSKL7TQPTcjs.f.call(void 0, n.items)):(_chunkSKL7TQPTcjs.e.call(void 0, e),Promise.resolve(_chunkSKL7TQPTcjs.f.call(void 0, _chunkSKL7TQPTcjs.c.call(void 0, n.items,e))));Array.isArray(e)&&_chunkSKL7TQPTcjs.e.call(void 0, e);let r=Array.isArray(e)?new URLSearchParams(e.map(s=>["key",s])).toString():null;return r===""?Promise.resolve({}):_chunkSKL7TQPTcjs.h.call(void 0, `${f}/items?version=${h}${r===null?"":`&${r}`}`,{headers:new Headers(c),cache:"no-store"}).then(async s=>{if(s.ok)return s.json();if(await s.arrayBuffer(),s.status===401)throw new Error(_chunkSKL7TQPTcjs.a.UNAUTHORIZED);if(s.status===404)throw new Error(_chunkSKL7TQPTcjs.a.EDGE_CONFIG_NOT_FOUND);if(s.cachedResponseBody!==void 0)return s.cachedResponseBody;throw new Error(_chunkSKL7TQPTcjs.a.UNEXPECTED)},()=>{throw new Error(_chunkSKL7TQPTcjs.a.NETWORK)})},async digest(){let e=await u(i);return e?Promise.resolve(e.digest):_chunkSKL7TQPTcjs.h.call(void 0, `${f}/digest?version=1`,{headers:new Headers(c),cache:"no-store"}).then(async n=>{if(n.ok)return n.json();if(await n.arrayBuffer(),n.cachedResponseBody!==void 0)return n.cachedResponseBody;throw new Error(_chunkSKL7TQPTcjs.a.UNEXPECTED)},()=>{throw new Error(_chunkSKL7TQPTcjs.a.NETWORK)})}}}var a;function l(){a||(a=N(process.env.EDGE_CONFIG))}var P=(...o)=>(l(),a.get(...o)),R= exports.getAll =(...o)=>(l(),a.getAll(...o)),A= exports.has =(...o)=>(l(),a.has(...o)),D= exports.digest =(...o)=>(l(),a.digest(...o));exports.createClient = N; exports.digest = D; exports.get = P; exports.getAll = R; exports.has = A; exports.parseConnectionString = _chunkSKL7TQPTcjs.g;
